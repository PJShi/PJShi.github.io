<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To Do List</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    
    <style>
    .list-item {
    display: flex;
    align-items: center;
    border: 1px solid #ccc;
    border-radius: 5px;
    padding: 10px;
    margin-bottom: 10px;
}

.list-item.done {
    background-color: #f2f2f2;
    text-decoration: line-through;
}

.list-btn {
    display: flex;
    align-items: center;
    justify-content: flex-end;}

.list-content {
    flex: 1;
}

.form-check-input {
    width: 20px;
    height: 20px;
    
}

</style>
</head>
<body>
    <div class="container">
        <h1 class="text-center mt-4">To Do List</h1>
        <div class="input-group mt-3">
            <input type="text" id="add-text" class="form-control" placeholder="To Do Something....">
            <div class="input-group-append">
                <button class="btn btn-primary" id="btn-plus">Add</button>
            </div>
        </div>
        <div class="list-box mt-3" id="todoList"></div>
        
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    
    

    <script>
// 宣告 --------------------------------------
let checkValue = false;//用於存儲每個待辦事項的勾選狀態
const key = 'todoListKey';

// DOM --------------------------------------
const btnPlus = document.getElementById('btn-plus');
const listBox = document.getElementById('todoList');


// function ----待辦事項清單渲染---------------------
function renderToDo() {
    // 初始化
    listBox.innerHTML = '';
    

    // 讀取 localStorage
    let todoList = JSON.parse(localStorage.getItem(key)) || [];

    // 動態長 HTML
    todoList.forEach((item, index) => {
        
        

        const listItem = document.createElement('div');
        listItem.className = 'list-item';

        //切換待辦事項的勾選狀態
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.className = 'form-check-input';
        checkbox.checked = item.check;
        checkbox.addEventListener('change', () => toggleTodoStatus(index));

        //編輯待辦事項內容
        const editButton = document.createElement('button');
        editButton.className = 'btn btn-info ml-2';
        editButton.innerText = 'Edit';
        editButton.addEventListener('click', () => editTodoItem(index));

        //刪除待辦事項資料清單
        const deleteButton = document.createElement('button');
        deleteButton.className = 'btn btn-danger ml-2';
        deleteButton.innerText = 'Delete';
        deleteButton.addEventListener('click', () => deleteTodoItem(index));

        //新增待辦事項清單
        const todoText = document.createElement('span');
        todoText.innerText = item.title;
        todoText.setAttribute('contenteditable', 'true');
        todoText.addEventListener('blur', () => editTodoTitle(index));

        

        listItem.appendChild(checkbox);
        listItem.appendChild(todoText);
        listItem.appendChild(editButton);
        listItem.appendChild(deleteButton);
        listBox.appendChild(listItem);

        // 檢查是否有 check
        if (item.check) {
            listItem.classList.add('done');
        }
    });
}

function toggleTodoStatus(index) {
    let todoList = JSON.parse(localStorage.getItem(key)) || [];
    todoList[index].check = !todoList[index].check;
    localStorage.setItem(key, JSON.stringify(todoList));
    renderToDo();
}

function editTodoTitle(index) {
    let todoList = JSON.parse(localStorage.getItem(key)) || [];
    todoList[index].title = event.target.innerText;
    localStorage.setItem(key, JSON.stringify(todoList));
}

function deleteTodoItem(index) {
    let todoList = JSON.parse(localStorage.getItem(key)) || [];
    todoList.splice(index, 1);
    localStorage.setItem(key, JSON.stringify(todoList));
    renderToDo();
}

function addTodoItem() {
    let todoItem = document.getElementById('add-text').value;
    let todoObj = {
        title: todoItem,
        check: checkValue
    };
    let todoList = JSON.parse(localStorage.getItem(key)) || [];
    todoList.push(todoObj);
    localStorage.setItem(key, JSON.stringify(todoList));
    document.getElementById('add-text').value = '';
    renderToDo();
}

// 監聽 新增按鈕
btnPlus.onclick = function () {
    addTodoItem();
};

// window.onload --------------------------------------
window.onload = function () {
    renderToDo();
};


    </script>
</body>
</html>